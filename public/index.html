<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SKR03/SKR04 Konten-Konverter ¬∑ ibis nova</title>
  <link rel="icon" href="/assets/logo.png"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{brand:{DEFAULT:'#204A87'}}}}}</script>
  <style>:focus-visible{outline:2px solid #204A87;outline-offset:3px}</style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">
  <header class="bg-white/90 backdrop-blur sticky top-0 z-50 border-b border-gray-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
      <img src="/assets/logo.png" alt="ibis nova logo" class="h-10 w-10 rounded"/>
      <div class="flex-1">
        <h1 class="text-xl sm:text-2xl font-semibold">SKR03/SKR04 Konten-Konverter</h1>
        <p class="text-sm text-gray-600" data-i18n="subtitle">Bidirektionale Kontonummer-Zuordnung</p>
      </div>
      <select id="lang" class="border rounded-lg px-2 py-1 text-sm">
        <option value="de">Deutsch</option>
        <option value="en">English</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      </select>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-8">
    <section class="bg-white shadow-sm border border-gray-200 rounded-2xl overflow-hidden">
      <div class="flex gap-2 bg-blue-600 text-white px-4 py-3">
        <button id="tab0304" class="px-3 py-1 rounded-lg bg-white/10 font-medium" data-i18n="tab0304">SKR03 ‚Üí SKR04</button>
        <button id="tab0403" class="px-3 py-1 rounded-lg hover:bg-white/10" data-i18n="tab0403">SKR04 ‚Üí SKR03</button>
      </div>

      <div class="p-4 border-t border-gray-200">
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2">üîé</span>
          <input id="query" type="text" inputmode="search" autocomplete="off"
                 class="w-full pl-10 pr-28 py-3 rounded-xl border border-gray-300 focus:border-brand shadow-inner"
                 placeholder="1200, 1800, Bank ‚Ä¶" />
          <button id="clearBtn" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 text-sm border rounded-lg bg-gray-50 hover:bg-gray-100" data-i18n="clear">
            Leeren
          </button>
        </div>
        <div class="mt-2 flex items-center justify-between gap-3">
          <p id="warn" class="text-xs text-red-600 hidden"></p>
          <label class="text-xs text-gray-600 flex items-center gap-2">
            <input id="showAllLangs" type="checkbox" class="rounded border-gray-300">
            <span data-i18n="showAllLangs">Alle Sprachen anzeigen (DE/EN/RU)</span>
          </label>
        </div>
        <p class="mt-2 text-xs text-gray-500" data-i18n="hint">
          Tipp: Enter startet die Suche ¬∑ Esc leert die Eingabe
        </p>
      </div>

      <div id="results" class="p-4 space-y-4"></div>

      <div id="extras" class="px-4 pb-5 space-y-4">
        <div id="recent" class="hidden">
          <div class="text-xs font-semibold text-gray-600" data-i18n="recentTitle">Zuletzt gesucht</div>
          <div id="recentList" class="mt-2 flex flex-wrap gap-2"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="max-w-3xl mx-auto px-4 py-10 text-sm text-gray-500">
    <div class="border-t border-gray-200 pt-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
      <div>¬© <span id="year"></span> ibis nova GmbH</div>
      <div class="italic" data-i18n="footerNote">
        App-Konzept &amp; Umsetzung: Sascha Schmidt ¬∑ Unterst√ºtzung durch KI
      </div>
    </div>
  </footer>

<script>
// i18n etc. (gek√ºrzt f√ºr √úbersichtlichkeit)
const I18N = {
  de:{subtitle:"Bidirektionale Kontonummer-Zuordnung",tab0304:"SKR03 ‚Üí SKR04",tab0403:"SKR04 ‚Üí SKR03",clear:"Leeren",
      hint:"Tipp: Enter startet die Suche ¬∑ Esc leert die Eingabe",exactMatch:"Exakte Zuordnung gefunden",
      noExact:"Keine exakte Zuordnung gefunden",label03:"SKR03",label04:"SKR04",label:"Bezeichnung",
      showAllLangs:"Alle Sprachen anzeigen (DE/EN/RU)",recentTitle:"Zuletzt gesucht",
      copyTo:"Zielkonto kopieren",copied:"Kopiert!"}
};

function norm(s){return (s||"").toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/√ü/g,'ss');}
function strip0(s){ return (s||"").toString().replace(/^0+/,''); }
function numericPart(s){ const m=(s||"").match(/\d+/g); return strip0(m?m.join(""):''); }

let mappings=[], direction="0304", lang="de";

// search (f√ºhrende Nullen + Begriffssuche)
function search(q){
  const qn = norm(q);
  const qNum = numericPart(q);
  let exact=null;
  for(const m of mappings){
    const from=(direction==="0304")?m.skr03:m.skr04;
    const to=(direction==="0304")?m.skr04:m.skr03;
    const labelDE=(m.label?.de||"");
    if(qNum && qNum===numericPart(from)){ exact={from,to,label:labelDE,labelDE}; break; }
    if(qn && (qn===norm(from)||qn===norm(labelDE))){ exact={from,to,label:labelDE,labelDE}; break; }
    if(qn && qn.length>=2 && norm(labelDE).includes(qn)){ exact={from,to,label:labelDE,labelDE}; break; }
  }
  return {exact};
}

// render usw. (gek√ºrzt f√ºr √úbersichtlichkeit)...
</script>
</body>
</html>